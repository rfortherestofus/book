<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="David Keyes">
<title>11&nbsp; Automatically Accessing Online Data – R for the Rest of Us: A Statistics-Free Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./packages.html" rel="next">
<link href="./quarto.html" rel="prev">
<link href="./assets/r-treasure-chest.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdn.usefathom.com/script.js" data-site="JNTNGGFP" defer=""></script><script type="text/javascript">!function(e,t){(e=t.createElement("script")).src="https://cdn.convertbox.com/convertbox/js/embed.js",e.id="app-convertbox-script",e.async=true,e.dataset.uuid="253225cc-0347-4cc7-a705-4ce4529649df",document.getElementsByTagName("head")[0].appendChild(e)}(window,document);</script>
<meta property="og:title" content="11&nbsp; Automatically Accessing Online Data – R for the Rest of Us: A Statistics-Free Introduction">
<meta property="og:description" content="">
<meta property="og:image" content="https://book.rfortherestofus.com/assets/featured-image.png">
<meta property="og:site_name" content="R for the Rest of Us: A Statistics-Free Introduction">
<meta property="og:image:height" content="547">
<meta property="og:image:width" content="1114">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./accessing-data.html">Part III: Automation and Collaboration</a></li><li class="breadcrumb-item"><a href="./accessing-data.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatically Accessing Online Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./assets/cover.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for the Rest of Us: A Statistics-Free Introduction</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/rfortherestofus/book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Visualizations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./crash-course.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An R Programming Crash Course</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principles of Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Custom Data Visualization Themes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Maps and Geospatial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Designing Effective Tables</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Reports, Presentations, and Websites</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R Markdown Reports</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parameterized-reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Parameterized Reporting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Slideshow Presentations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./websites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Websites</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Automation and Collaboration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatically Accessing Online Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Creating Functions and Packages</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Errata</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./purchase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Purchase</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#importing-data-from-google-sheets-with-googlesheets4" id="toc-importing-data-from-google-sheets-with-googlesheets4" class="nav-link active" data-scroll-target="#importing-data-from-google-sheets-with-googlesheets4">Importing Data from Google Sheets with googlesheets4</a>
  <ul class="collapse">
<li><a href="#connecting-to-google" id="toc-connecting-to-google" class="nav-link" data-scroll-target="#connecting-to-google">Connecting to Google</a></li>
  <li><a href="#reading-data-from-a-sheet" id="toc-reading-data-from-a-sheet" class="nav-link" data-scroll-target="#reading-data-from-a-sheet">Reading Data from a Sheet</a></li>
  <li><a href="#using-the-data-in-r-markdown" id="toc-using-the-data-in-r-markdown" class="nav-link" data-scroll-target="#using-the-data-in-r-markdown">Using the Data in R Markdown</a></li>
  <li><a href="#importing-only-certain-columns" id="toc-importing-only-certain-columns" class="nav-link" data-scroll-target="#importing-only-certain-columns">Importing Only Certain Columns</a></li>
  </ul>
</li>
  <li>
<a href="#accessing-census-data-with-tidycensus" id="toc-accessing-census-data-with-tidycensus" class="nav-link" data-scroll-target="#accessing-census-data-with-tidycensus">Accessing Census Data with tidycensus</a>
  <ul class="collapse">
<li><a href="#connecting-to-the-census-bureau-with-an-api-key" id="toc-connecting-to-the-census-bureau-with-an-api-key" class="nav-link" data-scroll-target="#connecting-to-the-census-bureau-with-an-api-key">Connecting to the Census Bureau with an API Key</a></li>
  <li><a href="#working-with-decennial-census-data" id="toc-working-with-decennial-census-data" class="nav-link" data-scroll-target="#working-with-decennial-census-data">Working with Decennial Census Data</a></li>
  <li><a href="#using-multiple-census-variables" id="toc-using-multiple-census-variables" class="nav-link" data-scroll-target="#using-multiple-census-variables">Using Multiple Census Variables</a></li>
  <li><a href="#analyzing-census-data" id="toc-analyzing-census-data" class="nav-link" data-scroll-target="#analyzing-census-data">Analyzing Census Data</a></li>
  <li><a href="#using-a-summary-variable" id="toc-using-a-summary-variable" class="nav-link" data-scroll-target="#using-a-summary-variable">Using a Summary Variable</a></li>
  </ul>
</li>
  <li>
<a href="#visualizing-american-community-survey-data" id="toc-visualizing-american-community-survey-data" class="nav-link" data-scroll-target="#visualizing-american-community-survey-data">Visualizing American Community Survey Data</a>
  <ul class="collapse">
<li><a href="#making-charts" id="toc-making-charts" class="nav-link" data-scroll-target="#making-charts">Making Charts</a></li>
  <li><a href="#making-population-maps-with-the-geometry-argument" id="toc-making-population-maps-with-the-geometry-argument" class="nav-link" data-scroll-target="#making-population-maps-with-the-geometry-argument">Making Population Maps with the geometry Argument</a></li>
  </ul>
</li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/rfortherestofus/book/blob/main/accessing-data.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/rfortherestofus/book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./accessing-data.html">Part III: Automation and Collaboration</a></li><li class="breadcrumb-item"><a href="./accessing-data.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatically Accessing Online Data</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-accessing-data-chapter" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Automatically Accessing Online Data</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header><h6 class="anchored">You are reading the free online version of this book. If you’d like to purchase a physical or electronic copy, you can buy it from <a href="https://nostarch.com/r-rest-us">No Starch Press</a>, <a href="https://www.powells.com/book/r-for-the-rest-of-us-9781718503328">Powell’s</a>, <a href="https://www.barnesandnoble.com/w/r-for-the-rest-of-us-david-keyes/1145069854?ean=9781718503328">Barnes and Noble</a> or <a href="https://a.co/d/fzAMxMV">Amazon</a>.</h6><p>So far, you’ve imported data into your projects from CSV files. Many online datasets allow you to export CSVs, but before you do so, you should look for packages to automate your data access. If you can eliminate the manual steps involved in fetching data, your analysis and reporting will be more accurate. You’ll also be able to efficiently update your report when the data changes.</p>
<p>R offers many ways to automate the process of accessing online data. In this chapter, I’ll discuss two such approaches. First, you will use the <code>googlesheets4</code> package to fetch data directly from Google Sheets. You’ll learn how to connect your R Markdown project to Google so you can automatically download data when a Google Sheet updates. Then, you’ll use the <code>tidycensus</code> package to access data from the US Census Bureau. You’ll work with two large census datasets, the Decennial Census and the American Community Survey, and practice visualizing them.</p>
<section id="importing-data-from-google-sheets-with-googlesheets4" class="level2"><h2 class="anchored" data-anchor-id="importing-data-from-google-sheets-with-googlesheets4">Importing Data from Google Sheets with googlesheets4</h2>
<p>By using the <code>googlesheets4</code> package to access data directly from Google Sheets, you avoid having to manually download data, copy it into your project, and adjust your code so it imports that new data every time you want to update a report. This package lets you write code that automatically fetches new data directly from Google Sheets. Whenever you need to update your report, you can simply run your code to refresh the data. In addition, if you work with Google Forms, you can pipe your data into Google Sheets, completely automating the workflow from data collection to data import.</p>
<p>Using the <code>googlesheets4</code> package can help you manage complex datasets that update frequently. For example, in her role at the Primary Care Research Institute at the University of Buffalo, Meghan Harris used it for a research project about people affected by opioid use disorder. The data came from a variety of surveys, all of which fed into a jumble of Google Sheets. Using <code>googlesheets4</code>, Harris was able to collect all of her data in one place and use R to put it to use. Data that had once been largely unused because accessing it was so complicated could now inform research on opioid use disorder.</p>
<p>This section demonstrates how the <code>googlesheets4</code> package works using a fake dataset about video game preferences that Harris created to replace her opioid survey data (which, for obvious reasons, is confidential).</p>
<section id="connecting-to-google" class="level3"><h3 class="anchored" data-anchor-id="connecting-to-google">Connecting to Google</h3>
<p>To begin, install the <code>googlesheets4</code> package by running <code>install.packages ("googlesheets4")</code>. Next, connect to your Google account by running the <code><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html">gs4_auth()</a></code> function in the console. If you have more than one Google account, select the account that has access to the Google Sheet you want to work with.</p>
<p>Once you do so, a screen should appear. Check the box next to <strong>See, Edit, Create, and Delete All Your Google Sheets Spreadsheets</strong>. This will ensure that R can access data from your Google Sheets account. Click <strong>Continue</strong>, and you should see the message “Authentication complete. Please close this page and return to R.” The <code>googlesheets4</code> package will now save your credentials so that you can use them in the future without having to reauthenticate.</p>
</section><section id="reading-data-from-a-sheet" class="level3"><h3 class="anchored" data-anchor-id="reading-data-from-a-sheet">Reading Data from a Sheet</h3>
<p>Now that you’ve connected R to your Google account, you can import the fake data that Harris created about video game preferences (access it at <a href="https://data.rfortherestofus.com/google-sheet" class="uri">https://data.rfortherestofus.com/google-sheet</a>). <a href="#fig-video-game-survey-data" class="quarto-xref">Figure&nbsp;<span>11.1</span></a> shows what it looks like in Google Sheets.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-video-game-survey-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-video-game-survey-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/video-game-survey-data.png" class="img-fluid figure-img" width="774">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-video-game-survey-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.1: The video game data in Google Sheets
</figcaption></figure>
</div>
</div>
</div>
<p>The <code>googlesheets4</code> package has a function called <code><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet()</a></code> that allows you to pull in data directly from a Google Sheet. Import the data by passing the spreadsheet’s URL to the function like so:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org">googlesheets4</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">survey_data_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="st">"https://docs.google.com/spreadsheets/d/1AR0_RcFBg8wdiY4Cj-k8vRypp_txh27MyZuiRdqScog/edit?usp=sharing"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take a look at the <code>survey_data_raw</code> object to confirm that the data was imported. Using the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function from the <code>dplyr</code> package makes it easier to read:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">survey_data_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function, which creates one output row per variable, shows that you’ve successfully imported the data directly from Google Sheets:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5
Columns: 5
$ Timestamp                         &lt;dttm&gt; 2022-05-16 15:20:50, 2022-05-16 15:…
$ `How old are you?`                &lt;chr&gt; "25-34", "45-54", "Under 18", "Over …
$ `Do you like to play video games` &lt;chr&gt; "Yes", "No", "Yes", "No", "Yes"
$ `What kind of games do you like?` &lt;chr&gt; "Sandbox, Role-Playing (RPG), Simula…
$ `What's your favorite game?`      &lt;chr&gt; "It's hard to choose. House Flipper …</code></pre>
</div>
</div>
<p>Once you have the data in R, you can use the same workflow you’ve been using to create reports with R Markdown.</p>
</section><section id="using-the-data-in-r-markdown" class="level3"><h3 class="anchored" data-anchor-id="using-the-data-in-r-markdown">Using the Data in R Markdown</h3>
<p>The following code is taken from an R Markdown report that Harris made to summarize the video games data. You can see the YAML, the <code>setup</code> code chunk, a code chunk that loads packages, and the code to import data from Google Sheets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Video Game Survey"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="in">  echo = FALSE,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="in">  warning = FALSE,</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="in">library(janitor)</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="in">library(googlesheets4)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="in"># Import data from Google Sheets</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="in">survey_data_raw &lt;- read_sheet("https://docs.google.com/spreadsheets/d/1AR0_RcFBg8wdiY4Cj-k8vRypp_txh27MyZuiRdqScog/edit?usp=sharing")</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This R Markdown document resembles those discussed in previous chapters, except for the way you import the data. Because you’re bringing it in directly from Google Sheets, there’s no risk of, say, accidentally reading in the wrong CSV. Automating this step reduces the risk of error.</p>
<p>The next code chunk cleans the <code>survey_data_raw</code> object, saving the result as <code>survey_data_clean</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="in"># Clean data</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="in">survey_data_clean &lt;- survey_data_raw %&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="in">  clean_names() %&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(participant_id = as.character(row_number())) %&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="in">    age = how_old_are_you,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="in">    like_games = do_you_like_to_play_video_games,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="in">    game_types = what_kind_of_games_do_you_like,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="in">    favorite_game = whats_your_favorite_game</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="in">  relocate(participant_id, .before = age) %&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(age = factor(age, levels = c("Under 18", "18-24", "25-34", "35-44", "45-54", "55-64", "Over 65")))</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the <code>clean_names()</code> function from the janitor package makes the variable names easier to work with. Defining a <code>participant_id</code> variable using the <code><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number()</a></code> function then adds a consecutively increasing number to each row, and the <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> function makes the number a character. Next, the code changes several variable names with the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function. The <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function then transforms the age variable into a data structure known as a <em>factor</em>, which ensures that age will show up in the right order in your chart. Finally, the <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> function positions <code>participant_id</code> before the <code>age</code> variable.</p>
<p>Now you can use the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function again to view your updated <code>survey_data_clean</code> data frame, which looks like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5
Columns: 6
$ timestamp      &lt;dttm&gt; 2022-05-16 15:20:50, 2022-05-16 15:21:28, 2022-05-16 1…
$ participant_id &lt;chr&gt; "1", "2", "3", "4", "5"
$ age            &lt;fct&gt; 25-34, 45-54, Under 18, Over 65, Under 18
$ like_games     &lt;chr&gt; "Yes", "No", "Yes", "No", "Yes"
$ game_types     &lt;chr&gt; "Sandbox, Role-Playing (RPG), Simulation and sports, Pu…
$ favorite_game  &lt;chr&gt; "It's hard to choose. House Flipper and Parkitect are m…</code></pre>
</div>
</div>
<p>The rest of the report uses this data to highlight various statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Respondent Demographics</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate number of respondents</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="in">number_of_respondents &lt;- nrow(survey_data_clean)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>We received responses from <span class="in">`r number_of_respondents`</span> respondents. Their ages are below.</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="in">survey_data_clean %&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="in">  select(participant_id, age) %&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_label(</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="in">    participant_id = "Participant ID",</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="in">    age = "Age"</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(weight = "bold"),</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_column_labels()</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_align(</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="in">    align = "left",</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="in">    columns = everything()</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_width(</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="in">    participant_id ~ px(200),</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="in">    age ~ px(700)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="fu"># Video Games</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>We asked if respondents liked video games. Their responses are below.</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="in">survey_data_clean %&gt;%</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="in">  count(like_games) %&gt;%</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="in">    x = like_games,</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="in">    y = n,</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="in">    fill = like_games</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="in">  )) +</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col() +</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="in">    "No" = "#6cabdd",</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="in">    "Yes" = "#ff7400"</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="in">  )) +</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "How Many People Like Video Games?",</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="in">    x = NULL,</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Number of Participants"</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal(base_size = 16) +</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="in">    legend.position = "none",</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.grid.minor = element_blank(),</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="in">    panel.grid.major.x = element_blank(),</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="in">    axis.title.y = element_blank(),</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="in">    plot.title = element_text(</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="in">      face = "bold",</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="in">      hjust = 0.5</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These sections calculate the number of survey respondents, then put this value in the text using inline R code; create a table that breaks down the respondents by age group; and generate a graph displaying how many respondents like video games. <a href="#fig-video-game-report" class="quarto-xref">Figure&nbsp;<span>11.2</span></a> shows the resulting report.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-video-game-report" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-video-game-report-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/video-game-report.png" class="img-fluid figure-img" width="966">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-video-game-report-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.2: The rendered video game report
</figcaption></figure>
</div>
</div>
</div>
<p>You can rerun the code at any point to fetch updated data. The survey had five responses today, but if you run it again tomorrow and it has additional responses, they will be included in the import. If you used Google Forms to run your survey and saved the results to a Google Sheet, you could produce this up-to-date report simply by clicking the Knit button in RStudio.</p>
</section><section id="importing-only-certain-columns" class="level3"><h3 class="anchored" data-anchor-id="importing-only-certain-columns">Importing Only Certain Columns</h3>
<p>In the previous sections, you read the data of the entire Google Sheet, but you also have the option to import only a section of a sheet. For example, the survey data includes a <code>timestamp</code> column. This variable is added automatically whenever someone submits a Google Form that pipes data into a Google Sheet, but you don’t use it in your analysis, so you could get rid of it.</p>
<p>To do so, use the <code>range</code> argument in the <code><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet()</a></code> function when importing the data like so:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://docs.google.com/spreadsheets/d/1AR0_RcFBg8wdiY4Cj-k8vRypp_txh27MyZuiRdqScog/edit?usp=sharing"</span>,</span>
<span>  range <span class="op">=</span> <span class="st">"Sheet1!B:E"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This argument lets you specify a range of data to import. It uses the same syntax you may have used to select columns in Google Sheets. In this example, <code>range = "Sheet1!B:E"</code> imports columns B through E (but not A, which contains the timestamp). Adding <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> and then running this code produces output without the <code>timestamp</code> variable:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5
Columns: 4
$ `How old are you?`                &lt;chr&gt; "25-34", "45-54", "Under 18", "Over …
$ `Do you like to play video games` &lt;chr&gt; "Yes", "No", "Yes", "No", "Yes"
$ `What kind of games do you like?` &lt;chr&gt; "Sandbox, Role-Playing (RPG), Simula…
$ `What's your favorite game?`      &lt;chr&gt; "It's hard to choose. House Flipper …</code></pre>
</div>
</div>
<p>There are a number of other useful functions in the <code>googlesheets4</code> package. For example, if you ever need to write your output back to a Google Sheet, the <code><a href="https://googlesheets4.tidyverse.org/reference/sheet_write.html">write_sheet()</a></code> function is there to help. To explore other functions in the package, check out its documentation website at <a href="https://googlesheets4.tidyverse.org/index.html" class="uri">https://googlesheets4.tidyverse.org/index.html</a>.</p>
<p>Now we’ll turn our attention to another R package that allows you to automatically fetch data, this time from the US Census Bureau.</p>
</section></section><section id="accessing-census-data-with-tidycensus" class="level2"><h2 class="anchored" data-anchor-id="accessing-census-data-with-tidycensus">Accessing Census Data with tidycensus</h2>
<p>If you’ve ever worked with data from the US Census Bureau, you know what a hassle it can be. Usually, the process involves visiting the Census Bureau website, searching for the data you need, downloading it, and then analyzing it in your tool of choice. This pointing and clicking gets very tedious after a while.</p>
<p>Kyle Walker, a geographer at Texas Christian University, and Matt Herman (creator of the Westchester COVID-19 website discussed in <a href="websites.html" class="quarto-xref"><span>Chapter 9</span></a>) developed the <code>tidycensus</code> package to automate the process of importing Census Bureau data into R. With <code>tidycensus</code>, you can write just a few lines of code to get data about, say, the median income in all counties in the United States.</p>
<p>In this section, I’ll show you how the <code>tidycensus</code> package works using examples from two datasets to which it provides access: the Decennial Census, administered every 10 years, and the annual American Community Survey. I’ll also show you how to use the data from these two sources to perform additional analysis and make maps by accessing geospatial and demographic data simultaneously.</p>
<section id="connecting-to-the-census-bureau-with-an-api-key" class="level3"><h3 class="anchored" data-anchor-id="connecting-to-the-census-bureau-with-an-api-key">Connecting to the Census Bureau with an API Key</h3>
<p>Begin by installing <code>tidycensus</code> using <code>install.packages("tidycensus")</code>. To use <code>tidycensus</code>, you must get an application programming interface (API) key from the Census Bureau. API keys are like passwords that online services use to determine whether you’re authorized to access data.</p>
<p>To obtain this key, which is free, go to <a href="https://api.census.gov/data/key_signup.html" class="uri">https://api.census.gov/data/key_signup.html</a> and enter your details. Once you receive the key by email, you need to put it in a place where <code>tidycensus</code> can find it. The <code><a href="https://walker-data.com/tidycensus/reference/census_api_key.html">census_api_key()</a></code> function does this for you, so after loading the tidycensus package, run the function as follows, replacing 123456789 with your actual API key:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/census_api_key.html">census_api_key</a></span><span class="op">(</span><span class="st">"123456789"</span>, install <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>install = TRUE</code> argument saves your API key in your <em>.Renviron</em> file, which is designed for storing confidential information. The package will look for your API key there in the future so that you don’t have to reenter it every time you use the package.</p>
<p>Now you can use tidycensus to access Census Bureau datasets. While the Decennial Census and the American Community Survey are the most common, Chapter 2 of Kyle Walker’s book <em>Analyzing US Census Data: Methods, Maps, and Models in R</em> discusses others you can access.</p>
</section><section id="working-with-decennial-census-data" class="level3"><h3 class="anchored" data-anchor-id="working-with-decennial-census-data">Working with Decennial Census Data</h3>
<p>The <code>tidycensus</code> packages includes several functions dedicated to specific Census Bureau datasets, such as <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> for Decennial Census data. To access data from the 2020 Decennial Census about the Asian population in each state, use the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> function with three arguments as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"P1_006N"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Setting the <code>geography</code> argument to “state” tells <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> to access data at the state level. In addition to the 50 states, it will return data for the District of Columbia and Puerto Rico. The <code>variables</code> argument specifies the variable or variables you want to access. Here, <code>P1_006N</code> is the variable name for the total Asian population. I’ll discuss how to identify other variables you may want to use in the next section. Finally, <code>year</code> specifies the year for which you want to access data — in this case, 2020.</p>
<p>Running this code returns the following:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 4
   GEOID NAME                 variable   value
   &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;      &lt;dbl&gt;
 1 42    Pennsylvania         P1_006N   510501
 2 06    California           P1_006N  6085947
 3 54    West Virginia        P1_006N    15109
 4 49    Utah                 P1_006N    80438
 5 36    New York             P1_006N  1933127
 6 11    District of Columbia P1_006N    33545
 7 02    Alaska               P1_006N    44032
 8 12    Florida              P1_006N   643682
 9 45    South Carolina       P1_006N    90466
10 38    North Dakota         P1_006N    13213
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>The resulting data frame has four variables. <code>GEOID</code> is the geographic identifier assigned to the state by the Census Bureau. Each state has a geographic identifier, as do all counties, census tracts, and other geographies. <code>NAME</code> is the name of each state, and variable is the name of the variable you passed to the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> function. Finally, <code>value</code> is the numeric value for the state and variable in each row. In this case, it represents the total Asian population in each state.</p>
<section id="identifying-census-variable-values" class="level4"><h4 class="anchored" data-anchor-id="identifying-census-variable-values">Identifying Census Variable Values</h4>
<p>You’ve just seen how to retrieve the total number of Asian residents of each state, but say you want to calculate that number instead as a percentage of all the state’s residents. To do that, first you need to retrieve the variable for the state’s total population.</p>
<p>The <code>tidycensus</code> package has a function called <code><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables()</a></code> that shows all of the variables from a Decennial Census. Run it with the <code>year</code> argument set to <code>2020</code> and <code>dataset</code> set to <code>pl</code> as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"pl"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Running this code pulls data from so-called redistricting summary data files (which Public Law 94-171 requires the Census Bureau to produce every 10 years) and returns the name, label (description), and concept (category) of all available variables:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 301 × 3
   name    label                                                         concept
   &lt;chr&gt;   &lt;chr&gt;                                                         &lt;chr&gt;  
 1 H1_001N " !!Total:"                                                   OCCUPA…
 2 H1_002N " !!Total:!!Occupied"                                         OCCUPA…
 3 H1_003N " !!Total:!!Vacant"                                           OCCUPA…
 4 P1_001N " !!Total:"                                                   RACE   
 5 P1_002N " !!Total:!!Population of one race:"                          RACE   
 6 P1_003N " !!Total:!!Population of one race:!!White alone"             RACE   
 7 P1_004N " !!Total:!!Population of one race:!!Black or African Americ… RACE   
 8 P1_005N " !!Total:!!Population of one race:!!American Indian and Ala… RACE   
 9 P1_006N " !!Total:!!Population of one race:!!Asian alone"             RACE   
10 P1_007N " !!Total:!!Population of one race:!!Native Hawaiian and Oth… RACE   
# ℹ 291 more rows</code></pre>
</div>
</div>
<p>By looking at this list, you can see that the variable <code>P1_001N</code> returns the total population.</p>
</section></section><section id="using-multiple-census-variables" class="level3"><h3 class="anchored" data-anchor-id="using-multiple-census-variables">Using Multiple Census Variables</h3>
<p>Now that you know which variables you need, you can use the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> function again with two variables at once:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P1_001N"</span>, <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adding <code>arrange(NAME)</code> after <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> sorts the results by state name, allowing you to easily see that the output includes both variables for each state:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 104 × 4
   GEOID NAME       variable    value
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
 1 01    Alabama    P1_001N   5024279
 2 01    Alabama    P1_006N     76660
 3 02    Alaska     P1_001N    733391
 4 02    Alaska     P1_006N     44032
 5 04    Arizona    P1_001N   7151502
 6 04    Arizona    P1_006N    257430
 7 05    Arkansas   P1_001N   3011524
 8 05    Arkansas   P1_006N     51839
 9 06    California P1_001N  39538223
10 06    California P1_006N   6085947
# ℹ 94 more rows</code></pre>
</div>
</div>
<p>When you’re working with multiple census variables like this, you might have trouble remembering what names like <code>P1_001N</code> and <code>P1_006N</code> mean. Fortunately, you can adjust the code in the call to <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> to give these variables more meaningful names using the following syntax:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    total_population <span class="op">=</span> <span class="st">"P1_001N"</span>,</span>
<span>    asian_population <span class="op">=</span> <span class="st">"P1_006N"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Within the <code>variables</code> argument, this code specifies the new names for the variables, followed by the equal sign and the original variable names. The <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function allows you to rename multiple variables at one time.</p>
<p>Now it’s much easier to see which variables you’re working with:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 104 × 4
   GEOID NAME       variable            value
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt;
 1 01    Alabama    total_population  5024279
 2 01    Alabama    asian_population    76660
 3 02    Alaska     total_population   733391
 4 02    Alaska     asian_population    44032
 5 04    Arizona    total_population  7151502
 6 04    Arizona    asian_population   257430
 7 05    Arkansas   total_population  3011524
 8 05    Arkansas   asian_population    51839
 9 06    California total_population 39538223
10 06    California asian_population  6085947
# ℹ 94 more rows</code></pre>
</div>
</div>
<p>Instead of <code>P1_001N</code> and <code>P1_006N</code>, the variables appear as <code>total_population</code> and <code>asian_population</code>. Much better!</p>
</section><section id="analyzing-census-data" class="level3"><h3 class="anchored" data-anchor-id="analyzing-census-data">Analyzing Census Data</h3>
<p>Now you have the data you need to calculate the Asian population in each state as a percentage of the total. There are just a few functions to add to the code from the previous section:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    total_population <span class="op">=</span> <span class="st">"P1_001N"</span>,</span>
<span>    asian_population <span class="op">=</span> <span class="st">"P1_006N"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="va">NAME</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="va">asian_population</span> <span class="op">/</span> <span class="va">total_population</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> function puts the values for Asian population and total population into their own variables. From there, you use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to calculate the percentage of the population in each state that is Asian, which you should see when you run this code:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 4
   NAME                 total_population asian_population    pct
   &lt;chr&gt;                           &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt;
 1 Alabama                       5024279            76660 0.0153
 2 Alaska                         733391            44032 0.0600
 3 Arizona                       7151502           257430 0.0360
 4 Arkansas                      3011524            51839 0.0172
 5 California                   39538223          6085947 0.154 
 6 Colorado                      5773714           199827 0.0346
 7 Connecticut                   3605944           172455 0.0478
 8 Delaware                       989948            42699 0.0431
 9 District of Columbia           689545            33545 0.0486
10 Florida                      21538187           643682 0.0299
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>This is a reasonable way to calculate the Asian population as a percentage of the total population in each state — but it’s not the only way.</p>
</section><section id="using-a-summary-variable" class="level3"><h3 class="anchored" data-anchor-id="using-a-summary-variable">Using a Summary Variable</h3>
<p>Kyle Walker knew that calculating summaries like you’ve just done would be a common use case for <code>tidycensus</code>. To calculate, say, the Asian population as a percentage of the whole, you need to have a numerator (the Asian population) and denominator (the total population). So, to simplify things, Walker included the <code>summary_var</code> argument, which can be used within <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> to import the total population as a separate variable. Instead of putting <code>P1_001N</code> (total population) in the variables argument and renaming it, you can assign it to the <code>summary_var</code> argument as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>asian_population <span class="op">=</span> <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>  summary_var <span class="op">=</span> <span class="st">"P1_001N"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This returns a nearly identical data frame to what you just got, except that the total population is now a separate variable, rather than additional rows for each state:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 5
   GEOID NAME                 variable           value summary_value
   &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;
 1 01    Alabama              asian_population   76660       5024279
 2 02    Alaska               asian_population   44032        733391
 3 04    Arizona              asian_population  257430       7151502
 4 05    Arkansas             asian_population   51839       3011524
 5 06    California           asian_population 6085947      39538223
 6 08    Colorado             asian_population  199827       5773714
 7 09    Connecticut          asian_population  172455       3605944
 8 10    Delaware             asian_population   42699        989948
 9 11    District of Columbia asian_population   33545        689545
10 12    Florida              asian_population  643682      21538187
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>With the data in this new format, now you can calculate the Asian population as a percentage of the whole by dividing the value variable by the <code>summary_value</code> variable. Then you drop the <code>summary_value</code> variable because you no longer need it after doing this calculation:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>asian_population <span class="op">=</span> <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>  summary_var <span class="op">=</span> <span class="st">"P1_001N"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="va">summary_value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">summary_value</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting output is identical to the output of the previous section:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 5
   GEOID NAME                 variable           value    pct
   &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;
 1 01    Alabama              asian_population   76660 0.0153
 2 02    Alaska               asian_population   44032 0.0600
 3 04    Arizona              asian_population  257430 0.0360
 4 05    Arkansas             asian_population   51839 0.0172
 5 06    California           asian_population 6085947 0.154 
 6 08    Colorado             asian_population  199827 0.0346
 7 09    Connecticut          asian_population  172455 0.0478
 8 10    Delaware             asian_population   42699 0.0431
 9 11    District of Columbia asian_population   33545 0.0486
10 12    Florida              asian_population  643682 0.0299
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>How you choose to calculate summary statistics is up to you; <code>tidycensus</code> makes it easy to do either way.</p>
</section></section><section id="visualizing-american-community-survey-data" class="level2"><h2 class="anchored" data-anchor-id="visualizing-american-community-survey-data">Visualizing American Community Survey Data</h2>
<p>Once you’ve accessed data using the <code>tidycensus</code> package, you can do whatever you want with it. In this section, you’ll practice analyzing and visualizing survey data using the American Community Survey. This survey, which is conducted every year, differs from the Decennial Census in two major ways: it is given to a sample of people rather than the entire population, and it includes a wider range of questions.</p>
<p>Despite these differences, you can access data from the American Community Survey nearly identically to how you access Decennial Census data. Instead of <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code>, you use the <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> function, but the arguments you pass to it are the same:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code uses the <code>B01002_001</code> variable to get median age data from 2020 for each state. Here’s what the output looks like:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 5
   GEOID NAME                 variable   estimate   moe
   &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;
 1 01    Alabama              B01002_001     39.2   0.1
 2 02    Alaska               B01002_001     34.6   0.2
 3 04    Arizona              B01002_001     37.9   0.2
 4 05    Arkansas             B01002_001     38.3   0.2
 5 06    California           B01002_001     36.7   0.1
 6 08    Colorado             B01002_001     36.9   0.1
 7 09    Connecticut          B01002_001     41.1   0.2
 8 10    Delaware             B01002_001     41     0.2
 9 11    District of Columbia B01002_001     34.1   0.1
10 12    Florida              B01002_001     42.2   0.2
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>You should notice two differences in the output from <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> compared to that from <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code>. First, instead of the value column, <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> produces a column called estimate. Second, it adds a column called <code>moe</code>, for the margin of error. These changes are the result of American Community Survey being given only to a sample of the population, since extrapolating values from that sample to produce an estimate for the population as a whole introduces a margin of error.</p>
<p>In the state-level data, the margins of error are relatively low, but in smaller geographies, they tend to be higher. Cases in which your margins of error are high relative to your estimates indicate a greater level of uncertainty about how well the data represents the population as a whole, so you should interpret such results with caution.</p>
<section id="making-charts" class="level3"><h3 class="anchored" data-anchor-id="making-charts">Making Charts</h3>
<p>To pipe your data on median age into ggplot to create a bar chart, add the following lines:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>    y <span class="op">=</span> <span class="va">NAME</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After importing the data with the <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> function, the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function pipes it directly into ggplot. States (which use the variable <code>NAME</code>) will go on the y-axis, and median age (<code>estimate</code>) will go on the x-axis. A simple <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> creates the bar chart shown in <a href="#fig-median-age-chart" class="quarto-xref">Figure&nbsp;<span>11.3</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-median-age-chart" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-median-age-chart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="accessing-data_files/figure-html/fig-median-age-chart-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-median-age-chart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.3: A bar chart generated using data acquired with the get_asc() function
</figcaption></figure>
</div>
</div>
</div>
<p>This chart is nothing special, but the fact that it takes just six lines of code to create most definitely is!</p>
</section><section id="making-population-maps-with-the-geometry-argument" class="level3"><h3 class="anchored" data-anchor-id="making-population-maps-with-the-geometry-argument">Making Population Maps with the geometry Argument</h3>
<p>In addition to co-creating <code>tidycensus</code>, Kyle Walker created the <code>tigris</code> package for working with geospatial data. As a result, these packages are tightly integrated. Within the <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> function, you can set the geometry argument to <code>TRUE</code> to receive both demographic data from the Census Bureau and geospatial data from <code>tigris</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the resulting data, you can see that it has the metadata and <code>geometry</code> column of the simple features objects that you saw in <a href="maps.html" class="quarto-xref"><span>Chapter 4</span></a>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 52 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -179.1467 ymin: 17.88328 xmax: 179.7785 ymax: 71.38782
Geodetic CRS:  NAD83
First 10 features:
   GEOID         NAME   variable estimate moe                       geometry
1     35   New Mexico B01002_001     38.1 0.1 MULTIPOLYGON (((-109.0502 3...
2     46 South Dakota B01002_001     37.2 0.2 MULTIPOLYGON (((-104.0579 4...
3     06   California B01002_001     36.7 0.1 MULTIPOLYGON (((-118.6044 3...
4     21     Kentucky B01002_001     39.0 0.1 MULTIPOLYGON (((-89.41728 3...
5     01      Alabama B01002_001     39.2 0.1 MULTIPOLYGON (((-88.05338 3...
6     13      Georgia B01002_001     36.9 0.1 MULTIPOLYGON (((-81.27939 3...
7     05     Arkansas B01002_001     38.3 0.2 MULTIPOLYGON (((-94.61792 3...
8     42 Pennsylvania B01002_001     40.9 0.2 MULTIPOLYGON (((-80.51989 4...
9     29     Missouri B01002_001     38.7 0.2 MULTIPOLYGON (((-95.77355 4...
10    08     Colorado B01002_001     36.9 0.1 MULTIPOLYGON (((-109.0603 3...</code></pre>
</div>
</div>
<p>The geometry type is <code>MULTIPOLYGON</code>, which you learned about in <a href="maps.html" class="quarto-xref"><span>Chapter 4</span></a>. To pipe this data into ggplot to make a map, add the following code:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After importing the data with <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> and piping it into the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, this code sets the <code>estimate</code> variable to use for the fill aesthetic property; that is, the fill color of each state will vary depending on the median age of its residents. Then <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> draws the map, and the <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c()</a></code> function gives it a colorblind-friendly palette.</p>
<p>The resulting map, shown in <a href="#fig-median-age-map-bad" class="quarto-xref">Figure&nbsp;<span>11.4</span></a>, is less than ideal because the Aleutian Islands in Alaska cross the 180-degree line of longitude, or the International Date Line. As a result, most of Alaska appears on one side of the map and a small part appears on the other side. What’s more, both Hawaii and Puerto Rico are hard to see.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-median-age-map-bad" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-median-age-map-bad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="accessing-data_files/figure-html/fig-median-age-map-bad-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-median-age-map-bad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.4: A hard-to-read map showing median age by state
</figcaption></figure>
</div>
</div>
</div>
<p>To fix these problems, load the tigris package, then use the <code><a href="https://rdrr.io/pkg/tigris/man/shift_geometry.html">shift_geometry()</a></code> To fix these problems, load the <code>tigris</code> package, then use the <code>shift _geometry()</code> function to move Alaska, Hawaii, and Puerto Rico into places where they’ll be more easily visible:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tigris/man/shift_geometry.html">shift_geometry</a></span><span class="op">(</span>preserve_area <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Setting the <code>preserve_area</code> argument to <code>FALSE</code> shrinks the giant state of Alaska and makes Hawaii and Puerto Rico larger. Although the state sizes in the map won’t be precise, the map will be easier to read, as you can see in <a href="#fig-median-age-map-good" class="quarto-xref">Figure&nbsp;<span>11.5</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-median-age-map-good" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-median-age-map-good-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="accessing-data_files/figure-html/fig-median-age-map-good-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-median-age-map-good-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11.5: An easier-to-read map tweaked using tigris functions
</figcaption></figure>
</div>
</div>
</div>
<p>Now try making the same map for all 3,000 counties by changing the <code>geography</code> argument to “county”. Other geographies include region, tract (for census tracts), place (for census-designated places, more commonly known as towns and cities), and congressional district. There are also many more arguments in both the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> and <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> functions; I’ve shown you only a few of the most common. If you want to learn more, Walker’s book <em>Analyzing US Census Data: Methods, Maps, and Models in R</em> is a great resource.</p>
</section></section><section id="summary" class="level2"><h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This chapter explored two packages that use APIs to access data directly from its source. The <code>googlesheets4</code> package lets you import data from a Google Sheet. It’s particularly useful when you’re working with survey data, as it makes it easy to update your reports when new results come in. If you don’t work with Google Sheets, you could use similar packages to fetch data from Excel365 (<code>Microsoft365R</code>), Qualtrics (<code>qualtRics</code>), Survey Monkey (<code>svmkrR</code>), and other sources.</p>
<p>If you work with US Census Bureau data, the <code>tidycensus</code> package is a huge time-saver. Rather than having to manually download data from the Census Bureau website, you can use <code>tidycensus</code> to write R code that accesses the data automatically, making it ready for analysis and reporting. Because of the package’s integration with <code>tigris</code>, you can also easily map this demographic data.</p>
<p>If you’re looking for census data from other countries, there are also R packages to bring data from Canada (<code>cancensus</code>), Kenya (<code>rKenyaCensus</code>), Mexico (<code>mxmaps</code> and <code>inegiR</code>), Europe (<code>eurostat</code>), and other regions. Before hitting that download button in your data collection tool to get a CSV file, it’s worth looking for a package that can import that data directly into R.</p>
</section><section id="additional-resources" class="level2"><h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li><p>Isabella Velásquez and Curtis Kephart, “Automated Survey Reporting with googlesheets4, pins, and R Markdown,” Posit, June 15, 2022, <a href="https://posit.co/blog/automated-survey-reporting/" class="uri">https://posit.co/blog/automated-survey-reporting/</a>.</p></li>
<li><p>Kyle Walker, <em>Analyzing US Census Data: Methods, Maps, and Models in R</em> (Boca Raton, FL: CRC Press, 2023), <a href="https://walker-data.com/census-r/" class="uri">https://walker-data.com/census-r/</a>.</p></li>
</ul>


</section></main><!-- /main --><script>
document.addEventListener("DOMContentLoaded", function() {
    // figure
    var figcaptions = document.querySelectorAll("figcaption, .quarto-xref");

    figcaptions.forEach(function(figcaption) {
        var captionText = figcaption.textContent;
        var regex = /Figure[\s\u00A0](\d+)\.(\d+)/g;
        var updatedCaption = captionText.replace(regex, "Figure $1-$2");
        
        figcaption.textContent = updatedCaption;
    });
    
    // section
    var sectionRefs = document.querySelectorAll(".quarto-xref");

    sectionRefs.forEach(function(sectionRef) {
        var sectionText = sectionRef.textContent;
        var regex = /Section (\d+)\.(\d+)\.(\d+)/g;
        var sectionTextUpdated = sectionText.replace(regex, "Section $1-$2-$3");
        
        sectionRef.textContent = sectionTextUpdated;
    });
    
});
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/book\.rfortherestofus\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="./quarto.html" class="pagination-link" aria-label="Quarto">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Quarto</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./packages.html" class="pagination-link" aria-label="Creating Functions and Packages">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Creating Functions and Packages</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/rfortherestofus/book/blob/main/accessing-data.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/rfortherestofus/book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>